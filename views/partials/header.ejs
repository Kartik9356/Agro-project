<script src="https://cdn.tailwindcss.com"></script>
<link
  href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap"
  rel="stylesheet"
/>
<script src="https://unpkg.com/@phosphor-icons/web"></script>

<style>
  body {
    font-family: "Inter", sans-serif;
  }
  /* Custom Scrollbar */
  ::-webkit-scrollbar {
    width: 8px;
  }
  ::-webkit-scrollbar-track {
    background: #f1f1f1;
  }
  ::-webkit-scrollbar-thumb {
    background: #888;
    border-radius: 4px;
  }
  ::-webkit-scrollbar-thumb:hover {
    background: #555;
  }
</style>

<header class="w-full bg-white shadow-sm font-sans">
  <div
    class="container mx-auto px-4 py-4 flex flex-col md:flex-row items-center justify-between gap-4"
  >
    <a href="/" class="flex items-center gap-2">
      <img
        src="/images/logo.svg"
        alt="<%= company.name %> Logo"
        class="h-16 w-auto object-contain"
      />
      <span class="text-xl font-bold text-[#4CAF50]"
        ><span class="text-black">Blue Berry</span> Impes</span
      >
    </a>

    <div class="flex-1 max-w-xl w-full relative">
      <div class="flex-1 max-w-xl w-full relative">
        <form
          action="/shop"
          method="GET"
          class="flex items-center border border-gray-300 rounded-full overflow-hidden bg-gray-50 focus-within:ring-2 focus-within:ring-[#4CAF50]"
        >
          <input
            type="text"
            name="search"
            placeholder="Search for products..."
            class="w-full py-3 px-5 outline-none bg-transparent text-gray-700"
            value="<%= activeSearch %>"
          />

          <div class="border-l border-gray-300 h-6"></div>

          <button
            type="submit"
            class="bg-gray-100 hover:bg-gray-200 text-gray-600 px-5 py-3 transition"
          >
            <i class="ph ph-magnifying-glass text-xl"></i>
          </button>
        </form>
      </div>
    </div>

    <div class="flex items-center gap-6">
      <div class="hidden lg:flex items-center gap-2 text-right">
        <div class="bg-gray-100 p-2 rounded-full">
          <i class="ph ph-phone-call text-[#4CAF50] text-xl"></i>
        </div>
        <div>
          <p class="text-xs text-gray-500 font-semibold">CALL US NOW</p>
          <p class="text-sm font-bold text-gray-800"><%= company.phone %></p>
        </div>
      </div>

      <div class="flex items-center gap-4 text-gray-700">
        <a href="#" class="hover:text-[#4CAF50] transition"
          ><i class="ph ph-heart text-2xl"></i
        ></a>
        <a href="#" class="hover:text-[#4CAF50] transition"
          ><i class="ph ph-user text-2xl"></i
        ></a>

        <a
          href="/cart"
          class="relative hover:text-[#4CAF50] transition flex items-center gap-2"
        >
          <div class="relative">
            <i class="ph ph-shopping-bag text-2xl"></i>
            <span
              id="cart-count"
              class="absolute -top-1 -right-2 bg-[#4CAF50] text-white text-[10px] font-bold px-1.5 py-0.5 rounded-full"
              >0</span
            >
          </div>
          <span id="cart-total" class="text-sm font-semibold hidden sm:block"
            >₹0.00</span
          >
        </a>
      </div>
    </div>
  </div>

  <nav class="bg-[#D32F2F] text-white">
    <div class="container mx-auto px-4">
      <div class="flex items-center justify-between">
        <div
          class="relative group cursor-pointer bg-[#B71C1C] px-6 py-4 flex items-center gap-3 font-bold uppercase tracking-wide text-sm"
        >
          <i class="ph ph-list text-xl"></i>
          <span>Categories</span>
          <i class="ph ph-caret-down ml-auto"></i>

          <div
            class="absolute top-full left-0 w-64 bg-white text-gray-800 shadow-xl border-t-2 border-[#D32F2F] hidden group-hover:block z-50"
          >
            <a
              href="/shop?category=Organic Fruits"
              class="block px-6 py-3 hover:bg-gray-50 border-b border-gray-100 transition flex justify-between items-center group/item"
            >
              Organic Fruits
              <i
                class="ph ph-caret-right text-gray-300 group-hover/item:text-[#4CAF50]"
              ></i>
            </a>

            <a
              href="/shop?category=Imported Fruits"
              class="block px-6 py-3 hover:bg-gray-50 border-b border-gray-100 transition flex justify-between items-center group/item"
            >
              Imported Fruits
              <i
                class="ph ph-caret-right text-gray-300 group-hover/item:text-[#4CAF50]"
              ></i>
            </a>

            <a
              href="/shop?category=Exotic Fruits"
              class="block px-6 py-3 hover:bg-gray-50 border-b border-gray-100 transition flex justify-between items-center group/item"
            >
              Exotic Fruits
              <i
                class="ph ph-caret-right text-gray-300 group-hover/item:text-[#4CAF50]"
              ></i>
            </a>

            <a
              href="/shop"
              class="block px-6 py-3 hover:bg-gray-50 transition font-bold text-[#D32F2F] flex justify-between items-center"
            >
              View All
              <i class="ph ph-arrow-right"></i>
            </a>
          </div>
        </div>

        <div
          class="hidden md:flex items-center gap-8 text-xs font-bold uppercase tracking-wider"
        >
          <a href="/" class="hover:text-yellow-300 transition">Home</a>
          <a href="/shop" class="hover:text-yellow-300 transition">Shop</a>
          <a href="/about" class="hover:text-yellow-300 transition">About Us</a>
          <a href="/contact" class="hover:text-yellow-300 transition"
            >Contact Us</a
          >
        </div>

        <a
          href="/packaging-delivery"
          class="hidden lg:block text-xs font-bold uppercase tracking-wider hover:text-yellow-300 transition"
        >
          Delivery & Packaging
        </a>
      </div>
    </div>
  </nav>
  <script>
    // 1. Run this immediately when any page loads
    document.addEventListener("DOMContentLoaded", () => {
      updateCartHeader();
    });

    // 2. Global "Add to Cart" Listener (Works on Home, Shop, Recommended, etc.)
    document.body.addEventListener("click", (e) => {
      // Check if the clicked element (or its parent) is an .add-to-cart-btn
      const button = e.target.closest(".add-to-cart-btn");

      if (button) {
        // Get product data from the HTML attributes
        // Inside document.body.addEventListener...

        const product = {
          id: button.dataset.id,
          name: button.dataset.name,
          price: parseFloat(button.dataset.price),
          image: button.dataset.image,
          unit: button.dataset.unit, // <--- ADD THIS LINE
          quantity: 1,
        };

        addToCart(product);

        // Visual Feedback
        const originalContent = button.innerHTML;
        button.innerHTML = '<i class="ph-fill ph-check-circle"></i> Added!';
        button.classList.remove("bg-[#4CAF50]", "hover:bg-[#388E3C]");
        button.classList.add("bg-gray-800");

        setTimeout(() => {
          button.innerHTML = originalContent;
          button.classList.remove("bg-gray-800");
          button.classList.add("bg-[#4CAF50]", "hover:bg-[#388E3C]");
        }, 1000);
      }
    });

    // 3. Core Cart Logic
    function addToCart(product) {
      let cart = JSON.parse(localStorage.getItem("cart")) || [];

      // Check if item already exists
      const existingItemIndex = cart.findIndex(
        (item) => item.id === product.id,
      );

      if (existingItemIndex > -1) {
        cart[existingItemIndex].quantity += 1;
      } else {
        cart.push(product);
      }

      localStorage.setItem("cart", JSON.stringify(cart));
      updateCartHeader();
    }

    // 4. Update Header Function
    function updateCartHeader() {
      const cart = JSON.parse(localStorage.getItem("cart")) || [];

      const totalItems = cart.reduce((sum, item) => sum + item.quantity, 0);
      const totalPrice = cart.reduce(
        (sum, item) => sum + item.price * item.quantity,
        0,
      );

      const cartCountEl = document.getElementById("cart-count");
      const cartTotalEl = document.getElementById("cart-total");

      if (cartCountEl) cartCountEl.textContent = totalItems;
      if (cartTotalEl) cartTotalEl.textContent = "₹" + totalPrice.toFixed(2);
    }
  </script>
</header>
